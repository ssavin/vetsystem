Техническое Задание для AI-агента: Клиентское Мобильное Приложение
Цель: Разработать мобильное приложение (MVP - Minimum Viable Product) для клиентов ветеринарных клиник, использующих платформу VetSystem. Приложение должно предоставлять доступ к основной информации и позволять записываться на прием.

Технологический стек:

Фреймворк: React Native с использованием Expo. (Expo — это инструмент, который невероятно упрощает разработку и сборку React Native приложений).

Компоненты UI: React Native Paper или аналогичная библиотека для готовых Material Design компонентов.

Навигация: React Navigation.

Управление состоянием: TanStack Query (как и в вашем веб-приложении).

Часть 1: Модификация Бэкенда (Express.js)
Мобильное приложение потребует нескольких новых, оптимизированных для мобильных устройств, API-эндпоинтов. Все они должны быть защищены JWT-аутентификацией.

Аутентификация:

Эндпоинт: POST /api/mobile/auth/login

Логика: Вход по номеру телефона. Клиент вводит номер, бэкенд генерирует SMS-код (через тот же SMS-сервис, что и для уведомлений), клиент вводит код, бэкенд проверяет его и возвращает JWT-токен. Это стандартный и безопасный способ для мобильных приложений.

Получение данных клиента:

Эндпоинт: GET /api/mobile/me/profile

Логика: Возвращает информацию о залогиненном клиенте и список его питомцев ({ owner: {...}, pets: [...] }).

Запись на прием:

Эндпоинт: GET /api/mobile/appointments/slots (Получение свободных слотов)

Query Params: doctorId, date.

Эндпоинт: POST /api/mobile/appointments (Создание записи)

Request Body: { petId, doctorId, startTime }.

История болезни:

Эндпоинт: GET /api/mobile/pets/:petId/history

Логика: Возвращает упрощенный список визитов (дата, врач, основной диагноз).

Push-уведомления:

Эндпоинт: POST /api/mobile/me/register-push-token

Request Body: { token: "expo-push-token" }.

Логика: Сохраняет уникальный push-токен устройства в базе данных, привязывая его к user_id, для последующей отправки уведомлений.

Задача для AI (Бэкенд): Реализуй указанные эндпоинты в Express.js. Создай новую логику для аутентификации по SMS. Обеспечь, чтобы все эндпоинты использовали JWT-аутентификацию и RLS (мультитентность).

Часть 2: Разработка Мобильного Приложения (React Native / Expo)
Шаг 1: Настройка проекта
Задача для AI: Инициализируй новый проект React Native с помощью Expo: npx create-expo-app vet-client-app. Настрой TypeScript и установи необходимые библиотеки (react-navigation, react-native-paper, @tanstack/react-query).

Шаг 2: Реализация экранов (Screens)
1. Экран Аутентификации (AuthScreen.tsx):

UI: Поле для ввода номера телефона. После ввода — поле для ввода SMS-кода.

Логика: Используй useMutation для отправки запросов на /api/mobile/auth/login. После успешного входа сохрани JWT-токен в безопасное хранилище на устройстве (например, expo-secure-store) и перенаправь пользователя на главный экран.

2. Главный экран / Дашборд (HomeScreen.tsx):

UI: Приветствие ("Здравствуйте, Иван!"). Карточки для быстрого доступа: "Мои питомцы", "Записаться на прием". Список предстоящих записей.

Логика: Используй useQuery для получения данных с /api/mobile/me/profile.

3. Экран "Мои питомцы" (PetsScreen.tsx):

UI: Список питомцев клиента (аватар, кличка, порода).

Логика: При клике на питомца — переход на экран PetDetailScreen, где отображается подробная информация и история визитов (запрос на /api/mobile/pets/:petId/history).

4. Экран Записи на прием (BookingScreen.tsx):

UI: Пошаговый процесс:

Выбор питомца.

Выбор услуги или специализации врача.

Выбор врача.

Выбор даты и свободного времени в календаре.

Логика: Цепочка useQuery запросов для получения данных на каждом шаге. В конце — useMutation для отправки данных на POST /api/mobile/appointments.

Шаг 3: Push-уведомления
Задача для AI:

На стороне приложения:

После входа пользователя в систему, используй библиотеку expo-notifications для получения push-токена устройства.

Отправь этот токен на бэкенд (POST /api/mobile/me/register-push-token) с помощью useMutation.

На стороне бэкенда (фоновый процесс):

Создай фоновую задачу (CRON job), которая будет запускаться раз в час.

Задача ищет приемы или вакцинации, которые должны состояться в ближайшее время (например, через 24 часа).

Для каждого найденного события она находит user_id, ищет в базе его push-токен.

Формирует и отправляет push-уведомление через сервер Expo Push Notifications.

