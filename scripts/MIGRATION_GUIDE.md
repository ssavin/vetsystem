# Инструкция по миграции клиентов из Vetais

## Подготовка

### 1. Узнайте структуру базы данных Vetais

Вам нужно узнать:
- **Параметры подключения к PostgreSQL** (хост, порт, имя БД, пользователь, пароль)
- **Название таблицы клиентов** в базе Vetais
- **Названия полей** в этой таблице:
  - Поле с именем клиента
  - Поле с телефоном
  - Поле с email (если есть)
  - Поле с адресом (если есть)

### 2. Как узнать структуру таблицы Vetais

Подключитесь к базе Vetais через psql или любой GUI клиент (pgAdmin, DBeaver) и выполните:

```sql
-- Список всех таблиц
\dt

-- Структура конкретной таблицы (замените table_name на имя таблицы клиентов)
\d table_name

-- Или через SQL
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'clients';  -- замените 'clients' на реальное имя таблицы
```

### 3. Пример структуры

Обычно в программах для ветклиник таблица клиентов может выглядеть так:

```
clients (или owners, или customers)
├── id
├── full_name (или name, client_name)
├── phone (или telephone, mobile)
├── email
├── address (или full_address, location)
└── ...другие поля
```

## Запуск миграции

### Способ 1: Через tsx (рекомендуется)

```bash
tsx scripts/migrate-vetais-clients.ts
```

### Способ 2: Через node с ts-node

```bash
npx ts-node scripts/migrate-vetais-clients.ts
```

## Процесс миграции

Скрипт проведет вас через следующие шаги:

1. **Параметры подключения к Vetais**
   - Хост (обычно `localhost` если база на вашем компьютере)
   - Порт (обычно `5432`)
   - Имя базы данных
   - Пользователь
   - Пароль
   - Название таблицы клиентов

2. **Маппинг полей**
   - Укажите названия полей из вашей базы Vetais для:
     - Имени клиента
     - Телефона
     - Email (можно пропустить)
     - Адреса (можно пропустить)

3. **Выбор целевой клиники**
   - Выберите в какую клиику (tenant) переносить данные
   - Опционально выберите филиал

4. **Подтверждение и миграция**
   - Скрипт покажет сколько клиентов найдено
   - Запросит подтверждение
   - Выполнит миграцию с отчетом о результатах

## Что делает скрипт

- ✅ Читает данные из базы Vetais
- ✅ Проверяет обязательные поля (имя и телефон)
- ✅ Проверяет дубликаты по телефону
- ✅ Вставляет клиентов в вашу систему VetSystem
- ✅ Показывает отчет о результатах
- ✅ Логирует ошибки

## Важные примечания

⚠️ **ПЕРЕД ЗАПУСКОМ:**
- Сделайте резервную копию вашей базы VetSystem
- Убедитесь, что база Vetais доступна для подключения
- Проверьте права доступа к обеим базам

⚠️ **ДУБЛИКАТЫ:**
- Скрипт пропускает клиентов с телефонами, которые уже есть в системе
- Если нужно обновлять существующих клиентов, потребуется доработка скрипта

⚠️ **ДАННЫЕ:**
- Обязательные поля: имя и телефон
- Клиенты без этих полей будут пропущены
- Все ошибки логируются в конце миграции
